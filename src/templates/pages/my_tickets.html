{% extends "layout.html" %}
{% block title %}My Tickets{% endblock %}
{% block head %}{{ super() }}{% endblock %}
{% block content %}
    {% include "/components/create_ticket_form.html" %}
    {% for ticket in tickets %}
        {% include "/components/ticket.html" %}
    {% endfor %}
{% endblock %}
{% block javascript %}
<script>
    function deleteTicket(id)
    {   
        fetch(`/tickets?id=${id}`, {
            method: "DELETE"
        }).then(response => {
            if (response.ok) {
                location.replace("{{ page }}")
            }
            else {
                return response.json().then(err => {
                    const errorMessage = `Error deleting ticket ${err.detail}` || "Create ticket failed. Please try again.";
                    const errorElement = document.getElementById(`error-${id}`);
                    errorElement.innerHTML = errorMessage;
                    errorElement.style.color = "red";
                    throw new Error(errorMessage);
                });
            }
        })  
    }

    function resolveTicket(id)
    {   
        fetch(`/tickets/resolve?id=${id}`, {
            method: "POST"
        }).then(response => {
            if (response.ok) {
                location.replace("{{ page }}")
            }
            else {
                return response.json().then(err => {
                    const errorMessage = `Error resolving ticket ${err.detail}` || "Resolving ticket failed. Please try again.";
                    const errorElement = document.getElementById(`error-${id}`);
                    errorElement.innerHTML = errorMessage;
                    errorElement.style.color = "red";
                    throw new Error(errorMessage);
                });
            }
        })  
    }
</script>
{% endblock %}